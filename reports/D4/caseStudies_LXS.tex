% !TEX root = MAIN.tex

\section{LXS - ESAIL System Test Suite}
\label{chapter:caseStudies:LXS}

\subsection{Overview of the case study}

\INDEX{ESAIL} is a microsatellite developed by LXS in a PPP with ESA and ExactEarth. 
The Payload is an AIS Receiver for ship- and vessel-detection from space, and the satellite weight at launch will be approximately 115kg. The satellite payload also enables advanced raw data handling and RF-Spectrum sampling for Ground processing.

\begin{figure}[h]
	\centering
    \includegraphics[width=0.7\textwidth]{images/esail}
    \caption{ESAIL system testing environment.}
    \label{fig:esail_case_study}
\end{figure}
 
The \INDEX{SVF simulator} has been used for functional validation of the ESAIL CSW (see Figure~\ref{fig:esail_case_study}). The SVF is indeed one of the main testing tools used in satellite projects. The SVF simulator can be seen as a testing facility that presents also its own dedicated test suite to ensure the correctness of the SVF models and assembly to avoid later misunderstanding of the expected behaviours of the satellite CSW. 
In the context of the FAQAS project we consider the system test suite for the validation of the CSW, which are implemented using the SVF as the driving tool.
%Therefore, the SVF Simulator enables the evaluation of the FAQAS framework against two test suites: (1) the Test Suite of the SVF Simulator that validates the Simulator itself, (2) the system tests for the validation of CSW, which are implemented using the SVF as the driving tool.

Details about ESAIL are provided in the document \emph{FAQAS-LXS-MAN-001\_1- SVF Software Installation and User Manual} uploaded on Alfresco.

ESAIL is the largest case study system in FAQAS, the software consists of 924 source files with a total size of 187\,116 LOC. The system test suite consists of 121 python test scripts with a total of 384 sub-test cases. 
\MREVISION{C-P-22}{The system test suite takes up to 10 hours to finish its execution; the total execution time may be different and depends on the processing power of the computer where the SVF is being executed.}

\subsubsection{ESAIL System Test Suite Environment}

Because of the objectives of the project, we will need to execute a large number of mutants. Even if strategies for simplifying and reducing the number of mutants are designed (see Section~1.2.4 from D2), there is a need for an infrastructure for running several mutant executions on parallel, which particularly applies for the ESAIL System Test Suite (e.g., the test suite execution time is high).

The University of Luxembourg provides a High-Performance Computing platform for academic purposes\footnote{https://hpc.uni.lu}.
The HPC has a computing capacity of 690 nodes, totaling 11\,280 computing cores, and a storage capacity of 8\,742 TB.

Given that ESAIL runs on a simulator (i.e., SVF), which is compute-intensive, and that resources of the UL HPC are shared between multiple jobs, non-deterministic behaviors are seldom observed (e.g., test cases fail because of lack of resources).

In view of the code-driven mutation testing process, where the quality of a test suite is assessed by checking if an injected fault is detected by the existing test cases, we need a test suite with a deterministic behavior, that is, if a test case fails it exclusively depends if we have introduced an artificial fault (i.e., a code mutation), and not because of the running environment.

To ensure that a mutant has been actually killed when executing the ESAIL System Suite on the UL HPC, we propose to execute a test case up to 10 times. If for any of this 10 executions the mutant is not killed, we consider it a live mutant. Otherwise, if it fails 10 times, we consider it a killed mutant.


Detailed information about the ESAIL system is provided in the following documents shared on Alfresco:

\begin{itemize}
	\item \emph{FAQAS-LXS-MAN-001\_1- SVF Software Installation and User Manual.pdf}, installation and testing instructions of the virtual machine containing ESAIL
	\item \emph{ESAIL-LXS-SDD-P-0105\_1B On-board Application Software Design Document.docx}, specifications document for the on-board system.
	\item \emph{ESAIL-LXS-ICD-P-0184\_2A ADCS IF SW External ICD.docx}, specifications document for the ADCS software.
	\item \emph{MOC-applicable MIB egos-mcs-s2k-icd-0001-version7.0-FINAL.pdf},  interface control document of the data import into SCOS-2000 run-time database, which is used to specify  the nominal value ranges for ESAIL ADCS parameters.
	\item \emph{ocp.dat}, text file for the SCOS-2000 Database Import ICD, containing the specifications of the nominal value ranges for ESAIL ADCS parameters.
\end{itemize}	


\subsection{Code-driven mutation analysis}
\label{lxs:esail:system:codeDriven}

%\TODO{Code coverage information: we need Yago to produce a new code coverage report with VCAST.}

\REVNOV{PTCR-34}{The \INDEX{code-driven mutation analysis process} in ESAIL will be performed in two stages. First we will use a subset of ESAIL ($\mathit{ESAIL}_S$) to evaluate the accuracy of the estimated mutation score (see Section~\ref{sec:evaluation}). Then, in later stages, we will apply the approach (including \INDEX{mutants sampling}, which is necessary for scalability purposes) to the whole ESAIL in order to (1) compare the mutation score obtained with the whole system with the mutation score obtained with $\mathit{ESAIL}_S$, (2) evaluate the accuracy of our strategy for removing equivalent/redundant mutants when applied to the whole ESAIL, (3) compare the \INDEX{mutation score} obtained for the whole $ESAIL$ and for $\mathit{ESAIL}_S$ after removing likely equivalent and likely redundant mutants.}

\REVNOV{PTCR-34}{$\mathit{ESAIL}_S$ had been selected by LXS engineers by identifying representative source files that belong to the following categories: (1) source files that are used almost all the time by the test cases (i.e., files implementing service/protocol layer functions), (2) critical functions of the satellite implemented in high-level drivers, (3)  higher level application level functions.}

\STARTCHANGEDNOV
The files included in $\mathit{ESAIL}_S$ are:
\begin{itemize}
\item \emph{HighLevelDriverLayer/TMTC\_SYS\_Handler/Source/tmtchdl\_TmTcSysHandlerTask.c}
\item \emph{ProtocolLayer/TCFrameReader/Source/TCFrameReader.c}
\item \emph{ProtocolLayer/TMFrameBuilder/Source/TMFrameBuilder.c}
\item \emph{ServiceLayer/PUS\_1/Source/pus1\_GenerateReport.c}
\item \emph{ServiceLayer/PUS\_3/Source/pus3\_GenerateHkGroupReport.c}
\item \emph{ServiceLayer/PUS\_3/Source/pus3\_ExecuteTc\_3\_129.c}
\item \emph{ServiceLayer/PUS\_128/Source/pus128\_ExecuteTc\_128\_1.c}
\item \emph{ServiceLayer/PUS\_130/Source/pus130\_ExecuteTc\_130\_1.c}
\item \emph{ApplicationLayer/Operational\_Sequences/Source/SpacecraftConfigurationVector.c}
\item \emph{ApplicationLayer/Operational\_Sequences/Source/Transition\_To\_OPM.c}
\end{itemize}
\ENDCHANGEDNOV

Concerning the experiments conducted on the whole ESAIL, they will target all the components of the ESAIL on-board software, these components are:

\begin{itemize}
	\item ADCS
	\item CAN
	\item EPS
	\item FDIR
	\item OPSE
	\item SERVICES
	\item TCS
	\item TMTC
\end{itemize}

% Code coverage information concerning the system-level test suite used for FAQAS is reported in \emph{FAQAS-LXS-MAN-001\_1- SVF Software Installation and User Manual.pdf}.
%\TODO{FIX}
\REVOCT{C-P-6}{Regarding code coverage, the ESAIL system test suite reports 67,022 out of 74,155 lines of code being covered (i.e., 90.38\% statement coverage). 
In our empirical evaluation, we rely on the ESAIL unit test suite to evaluate if mutation analysis results can be combined (see Section~\ref{sec:exp:thr}). 
In the ESAIL development context, the unit test suite is used to exercise critical functions hard to exercise with the system test suites. For this reason, the unit test suite covers only a portion of the code. 
MASS applies mutation analysis only to code that is covered by the test suite, for this reason, since we rely on the unit test suite only to evaluate the combination of multiple test suites, only the code coverage of the system test suite is relevant (i.e., we do not mutate lines exercised by the unit test suite only).
More details concerning the system-level test suite used for FAQAS is reported in \emph{FAQAS-LXS-MAN-001\_1- SVF Software Installation and User Manual.pdf}}


\subsection{Data-driven mutation analysis}

\REVOCT{C-P-25}{In the context of data-driven mutation analysis we examine three \SAIL software sub-systems: (1) the Attitude Determination and Control System (ADCS), the Global Positioning System (GPS), and the Payload Data Handling Unit (PDHU). Our data-driven mutation analysis tool (DAMAT), is then used to assess the extent to which \SAIL system test suite covers interoperability problems that have an impact on the integration between the central software, and the three sub-systems under test.}

A detailed description of the application of data-driven mutation analysis to ESAIL is provided in APPENDIX~\ref{appendix:FMS}.

\section{LXS - ESAIL Unit Test Suite}
\label{chapter:caseStudies:LXS:Unit}



The unit test suite of ESAIL will be considered for the evaluation of the final FAQAS toolset. 
%For example, it is a possible case to be used for an independent use of the FAQAS framework by LXS engineers. The ESAIL unit test suite is used mainly to test critical functionalities of ESAIL components. The ESAIL unit test suite has been provided to ESA; however, the mutation testing activity might concern a subset of them. Indeed, evaluating with mutation testing a set of test cases that are known for covering only a subset of the features of the system might be of little usefulness. 
%%The set of test cases and functions to be tested will be provided along with the description of the achieved results at the end of WP3.
To assess the quality of the ESAIL unit test suite we will analyze the same ESAIL sub-system defined in Section~\ref{lxs:esail:system:codeDriven}, and thus, we will target the same set of mutants. Since the ESAIL Unit Test Suite has been implemented by LXS to cover scenarios hard to cover with a full simulation (consequently, it cover a limited portion of the code), we will use the ESAIL Unit Test Suite to provide a complementary analysis to the one given by the system test suite.

