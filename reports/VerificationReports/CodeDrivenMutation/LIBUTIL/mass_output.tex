% !TEX root = MAIN.tex

\chapter{Mutation Analysis Results}
\label{mass_output}

% \TODO{Title should be about 'Results' not 'Process'}

\DONE{Re-read the paper to fix third person singular/plural errors}

In this chapter, we report the outcome of the mutation analysis process through the use of MASS. 
Mutation analysis assess the quality of test suites by injecting artificial faults in the source code (i.e., a mutant), and then measures the number of mutated versions that are detected by the test suite. The result is reported in terms of a mutation score, that is, the number of killed mutants (i.e., artificial faults detected by the test suite) divided by the total number of mutants.

\DONE{This is a verification report, which means that we need to provide action items for the company. What is the suggestions form below, should they reach 100\% code coverage?}

\input{tables/source_list}

Concerning the components of Libutil to be considered on the mutation analysis process, GomSpace indicated a subset of files from the library, that is not of interest for them, because they are source code belonging to third parties. In consequence, we exclude these sources from the analysis; the sources are listed in Table~\ref{table:not_interesting}.

%The code-driven mutation analysis process in Libutil targeted all the components covered by the Libutil unit test suite. 
The Libutil unit test suite do not cover hardware-specific functions (e.g., drivers), which are covered at the system level.

\section{Test Suite Code Coverage}

\begin{table}[h]
\centering
\begin{tabular}{|l|l|}
\hline
\textbf{Coverage Type} & \textbf{Coverage Rate} \\
\hline
Statement     & 60.2\% (1\,754 of 2\,915 statements)\\
Functions     & 66.1\% (201 of 304 functions)\\
Branches      & 52.2\% (1\,025 of 1\,965 branches)\\
\hline
\end{tabular}
\caption{Libutil code coverage.}
\label{table:gslibutil_coverage}
\end{table}

Prior applying mutation analysis to Libutil, we calculated the code coverage of the test suite. Table~\ref{table:gslibutil_coverage} provides the code coverage information of the unit test suite for the Libutil library. Note that the code coverage reported here does not include the source files from Table~\ref{table:not_interesting}. 

\EMPH{Action Item 1}{To improve the quality of the unit test suite, ideally GSL should improve the statement and branch coverage, and make both metrics reach 100\%.}

% \TODO{We know that a subset of the files are third party and not of interest from the test suite; we should exclude them, no?}


\section{MASS Results}

After applying MASS to the artifact, we report in the following the metrics produced by the tool:

\begin{itemize}
	\item MASS generates a total of 8\,572 mutants, this set of mutants was generated using the operators ABS, AOR, ICR, LCR, ROR, SDL, UOI, AOD, LOD, ROD, BOD, SOD, and LVR.

	\item 2\,575 mutants are filtered by trivial compiler optimisations, that is, mutants that are equivalent with respect to the original program or redundant with respect to other mutants.

	\item In total, MASS analyzed 5\,997 mutants, the process took 962 minutes (16 hours) to complete.

	\item The Libutil test suite identified a total of 4\,440 mutants (i.e., killed mutants).

	\item The Libutil test suite did not identify a total of 1\,557 mutants (i.e., live mutants).

	\item From the set of live mutants, MASS identified additionally 842 likely equivalent mutants based on code coverage.

	\item The MASS mutation score is 86.13\%.

	\item The statement coverage is 60.2\%.
	
	\item The total number of statements covered is 1\,754.
	
	\item The minimum statements covered per source file is 2, and the maximum is 347 statements per source file.
\end{itemize}

\EMPH{Action Item 2}{It has been shown that test suites with mutation score greater than 75\% have a higher fault detection rate~\cite{chekam2017empirical}. This implies that the Libutil test suite has a high fault detection rate.}

\DONE{Recompute the numbers above for the subset of files that are of interest for GSL}

% \TODO{What do we conclude form the above? Are you excluding source files that are not of interest for LXS?}

\subsection{Libutil Live Mutants}


In this section, we provide detailed information about some live mutants from the Libutil unit test suite.

\subsubsection{Live Mutant \#1}

\begin{itemize}
\item \textbf{Source file:} \texttt{src/fletcher.c}
\item \textbf{Mutant ID:} \url{fletcher.mut.65.1_1_9.LOD.gs_fletcher16_update}
\end{itemize}

\begin{lstlisting}[language=C, label=live_1, caption=Original source code.]
void gs_fletcher16_update(gs_fletcher16_t * f16, const void * data_in, size_t size)
{
    if (f16 && data_in && size) {
        const uint8_t * data = data_in;
        for (unsigned int idx = 0; idx < size; ++idx) {
            f16->sum1 = (uint16_t)((f16->sum1 + (*data++)) % 255);
            f16->sum2 = (uint16_t)((f16->sum2 + f16->sum1) % 255);
        }
    }
}
\end{lstlisting}

\begin{lstlisting}[language=C, label=live_1, caption=Mutant source code.]
void gs_fletcher16_update(gs_fletcher16_t * f16, const void * data_in, size_t size)
{
    if (f16) { // first and second operand deleted
        const uint8_t * data = data_in;
        for (unsigned int idx = 0; idx < size; ++idx) {
            f16->sum1 = (uint16_t)((f16->sum1 + (*data++)) % 255);
            f16->sum2 = (uint16_t)((f16->sum2 + f16->sum1) % 255);
        }
    }
}
\end{lstlisting}


\EMPH{Action Item 3}{It seems that the test cases are not verifying a scenario in which both parameters \texttt{f16} and \texttt{data} are null. Maybe you have done it through code inspection; however, this may lead to regressions faults not being detected by the test suite in the future (e.g., you modify the code and remove the null check). It is advisable to have such test cases in the unit test suite.}


\DONE{Report the mutants that we have already shared with them. Avoid duplicate ones.}
