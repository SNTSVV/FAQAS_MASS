% !TEX root = MAIN.tex

\chapter{Software Defects}

Listing~\ref{semus:testUtil}, shows the test case generated for a mutant of function \emph{timestamp\_diff} in Libutil.
This function receives as input two parameters, \emph{base} and \emph{diff}; it subtracts \emph{diff} from \emph{base} and updates the value of \emph{base}. Both \emph{base} and \emph{diff} are of type \emph{struct gs\_timestamp\_t}, which is shown in Figure~\ref{semus:testUtil:struct}.


The test case initializes \emph{base} and \emph{diff} as follows:
\begin{verbatim}
base = {tv_sec= 0,tv_nsec= 0};
diff = {tv_sec= 0,tv_nsec=1}
\end{verbatim}

The output generated by the SUT (i.e., the output stored by SEMuS in the file \emph{.expected}) is the following:
\begin{verbatim}
result_faqas_semu = 0
base->tv_sec = 4294967295
base->tv_nsec = 999999999
\end{verbatim}

The output above, which simply reflects the actual behavior of the implementation, show that the difference between zero (i.e, \emph{base = {tv\_sec= 0,tv\_nsec= 0};}) and one nanosecond  (i.e., \emph{diff = {tv\_sec= 0,tv\_nsec=1}})leads to a big integer (i.e., we observe an \EMPH{integer underflow}); instead, according to specifications, it should make the function return an error code (i.e., a value different than zero shall be assigned to \emph{result\_faqas\_semu} in the output above).


\begin{lstlisting}[language=C, caption=Test case generated for Libutil., label=semus:testUtil]
int main(int argc, char** argv)
{
    (void)argc;
    (void)argv;

    // Declare variable to hold function returned value
    int result_faqas_semu;

    // Declare arguments and make input ones symbolic
    gs_timestamp_t base;
    gs_timestamp_t diff;
    memset(&base, 0, sizeof(base));
    memset(&diff, 0, sizeof(diff));
    const unsigned char base_faqas_semu_test_data[] = {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
    const unsigned char diff_faqas_semu_test_data[] = {0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00};
    memcpy(&base, base_faqas_semu_test_data, sizeof(base));
    memcpy(&diff, diff_faqas_semu_test_data, sizeof(diff));

    // Call function under test
    result_faqas_semu = timestamp_diff(&base, &diff);

    // Make some output
    printf("FAQAS-SEMU-TEST_OUTPUT: result_faqas_semu = %d\n", result_faqas_semu);
    printf("FAQAS-SEMU-TEST_OUTPUT: base->tv_sec = %d\n", base->tv_sec);
    printf("FAQAS-SEMU-TEST_OUTPUT: base->tv_nsec = %d\n", base->tv_nsec);
    return (int)result_faqas_semu;
}
\end{lstlisting}

\begin{lstlisting}[language=C, caption=Definition of \emph{gs\_timestamp\_t} in Libutil., label=semus:testUtil:struct]
struct gs_timestamp_t {
    uint_32t  tv_sec;
    uint_32t  tv_nsec;
}
\end{lstlisting}

