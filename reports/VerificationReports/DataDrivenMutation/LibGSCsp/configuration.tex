% !TEX root = MAIN.tex

\chapter{Configuration of the tool-set}

\section{Probe insertion}

In the \case the mutation probes were inserted into the inserted in the function \emph{csp\_service\_handler}, contained in the file \emph{libgscsp/lib/libcsp/src/csp\_service\_handler.c}

This function handles an incoming connection and depending on the destination port, handles the packet to the corresponding service handler. The function takes as a parameter a connection structure of type \emph{csp\_conn\_}t and a \emph{LibGSCSP} packet of type \emph{csp\_packet\_t}. Both are represented by custom data structures.

We were interested in mutating \emph{idin} field, which contain the header of the LibGSCSP packet.

The packet header is represented by the data structure \emph{csp\_id\_t}. To enable the application of \DAMA, the data is converted into an array before mutation and converted back afterwards.

In both cases, a \emph{Mutation Probe} has been inserted to mutate the data contained in the buffer.
An example of this probe insertion strategy is reported in Listing~\ref{lst:probe_insertion}.

\begin{lstlisting}[language=C++, caption=Probe insertion Strategy, label={lst:probe_insertion}]

// manually inserted probe

int damat_buffer[7];

damat_buffer[0] = 0;
damat_buffer[1] = csp_conn_pri_faqas(conn);
damat_buffer[2] = csp_conn_src(conn);//conn->idin.src;
damat_buffer[3] = csp_conn_dst(conn);//conn->idin.dst;
damat_buffer[4] = csp_conn_dport(conn);//conn->idin.dport;
damat_buffer[5] = csp_conn_sport(conn);//conn->idin.sport;
damat_buffer[6] = csp_conn_flags(conn);//conn->idin.flags;

mutate_FM_Identifier(damat_buffer);

set_conn_idin_pri(conn,damat_buffer[1]);
set_conn_idin_src(conn,damat_buffer[2]);
set_conn_idin_dst(conn,damat_buffer[3]);
set_conn_idin_dport(conn,damat_buffer[4]);
set_conn_idin_sport(conn,damat_buffer[5]);
set_conn_idin_flags(conn,damat_buffer[6]);

// end of probe

\end{lstlisting}

\section{Fault Model}

The target of the mutation was the header of the LibGSCSP packet on so we defined a single specific Fault Model, called \emph{Identifier}; the relative mutation operators are reported in Table~\ref{tab:fault_model}.

\input{tables/fault_model}

Every line of the fault model file represents a mutation operator, while every column represents a configuration parameter for that operator.

\begin{itemize}
  \item Column \emph{FaultModel} contains the name of the Fault Model containing the operator. Typically the user shall define a fault model for every different kind of message exchanged through the buffer.

  \item Column \emph{DataItem} refers to the index of the first element of the targeted data item in the array representing the buffer.

  \item Column \emph{Span} reports the number of array elements that make up the data item target by the mutation.

  \item Column \emph{Type} reports about the type of data targeted by the mutation: \texttt{INT}, \texttt{LONG}, \texttt{FLOAT}, \texttt{DOUBLE}, \texttt{BIN} or \texttt{HEX}.

  \item Column \emph{FaultClass} contains the type of fault that the mutation will emulate, depending on the chosen mutation operator. A summary of the mutation operators can be found in Table~\ref{tab:operators}.

  \item The other columns represent configuration parameters and assume different meanings depending on the mutation operator they refer to. More details on the data-driven mutation operators and their configuration can be found in Table~\ref{tab:operators}.

\end{itemize}

\input{tables/operators}

A mutation operator can generate one or more mutants performing a \emph{Mutation Operation}.
